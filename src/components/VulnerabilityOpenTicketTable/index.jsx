import React, { useEffect, useState } from 'react'
import styles from "./index.module.css"
import Utils from "../../utils";
import { useAssets } from '../../context/AssetsContext';
import Table from '../Table/Table';
import { useVulnerability } from '../../context/VulnerabilityContext';
const VulnerabilityOpenTicketTable = () => { 



    const {vulnerabilityOpenTicket, fetchVulnerabilityOpenTicket} = useVulnerability();
    //console.log(vulnerabilityOpenTicket)
    const [vulerabilityData,setVulnerabilityData] = useState({
      "data": [
        {
          "assigned_to": "Amit Negi",
          "created_on": "26  July,  2024",
          "priority": "Medium",
          "status": "To Do",
          "ticket_id": "T-260724-0005"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "26  July,  2024",
          "priority": "Medium",
          "status": "To Do",
          "ticket_id": "T-260724-0004"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "26  July,  2024",
          "priority": "Medium",
          "status": "To Do",
          "ticket_id": "T-260724-0003"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "26  July,  2024",
          "priority": "Medium",
          "status": "To Do",
          "ticket_id": "T-260724-0002"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "26  July,  2024",
          "priority": "Medium",
          "status": "To Do",
          "ticket_id": "T-260724-0001"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "8  July,  2024",
          "priority": "Low",
          "status": "In-Progress",
          "ticket_id": "T-250724-0019"
        },
        {
          "assigned_to": "himanshu",
          "created_on": "25  July,  2024",
          "priority": "Urgent",
          "status": "In-Progress",
          "ticket_id": "T-250724-0018"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "25  July,  2024",
          "priority": "Urgent",
          "status": "In-Progress",
          "ticket_id": "T-250724-0017"
        },
        {
          "assigned_to": "himanshu",
          "created_on": "4  July,  2024",
          "priority": "Medium",
          "status": "In Review",
          "ticket_id": "T-250724-0016"
        },
        {
          "assigned_to": "shubhamk",
          "created_on": "12  July,  2024",
          "priority": "Medium",
          "status": "In Review",
          "ticket_id": "T-250724-0015"
        },
        {
          "assigned_to": "shubhamk",
          "created_on": "15  July,  2024",
          "priority": "Medium",
          "status": "In-Progress",
          "ticket_id": "T-250724-0014"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "9  July,  2024",
          "priority": "Low",
          "status": "In Review",
          "ticket_id": "T-250724-0013"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "13  July,  2024",
          "priority": "Medium",
          "status": "In-Progress",
          "ticket_id": "T-250724-0012"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "26  July,  2024",
          "priority": "Low",
          "status": "To Do",
          "ticket_id": "T-250724-0011"
        },
        {
          "assigned_to": "himanshu",
          "created_on": "18  July,  2024",
          "priority": "Low",
          "status": "In-Progress",
          "ticket_id": "T-250724-0010"
        },
        {
          "assigned_to": "shubhamk",
          "created_on": "19  July,  2024",
          "priority": "Low",
          "status": "To Do",
          "ticket_id": "T-250724-0009"
        },
        {
          "assigned_to": "shubhamk",
          "created_on": "21  July,  2024",
          "priority": "Low",
          "status": "To Do",
          "ticket_id": "T-250724-0009"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "11  July,  2024",
          "priority": "High",
          "status": "In Review",
          "ticket_id": "T-250724-0008"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "22  July,  2024",
          "priority": "High",
          "status": "Completed",
          "ticket_id": "T-250724-0008"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "5  July,  2024",
          "priority": "High",
          "status": "Completed",
          "ticket_id": "T-250724-0007"
        },
        {
          "assigned_to": "shubhamk",
          "created_on": "14  July,  2024",
          "priority": "Medium",
          "status": "Completed",
          "ticket_id": "T-250724-0006"
        },
        {
          "assigned_to": "himanshu",
          "created_on": "22  July,  2024",
          "priority": "High",
          "status": "In Review",
          "ticket_id": "T-250724-0005"
        },
        {
          "assigned_to": "himanshu",
          "created_on": "16  July,  2024",
          "priority": "High",
          "status": "In-Progress",
          "ticket_id": "T-250724-0004"
        },
        {
          "assigned_to": "Amit Negi",
          "created_on": "19  July,  2024",
          "priority": "Medium",
          "status": "Completed",
          "ticket_id": "T-250724-0003"
        },
        {
          "assigned_to": "rishikj",
          "created_on": "25  July,  2024",
          "priority": "Medium",
          "status": "Completed",
          "ticket_id": "T-250724-0001"
        }
      ],
      "page": 1,
      "per_page": 10,
      "total": 2780,
      "total_pages": 278
    }
    )
    useEffect(()=>{
      fetchVulnerabilityOpenTicket();
    },[]);
    // //console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",vulnerabilityList)
    function getTableData(data) {

        //console.log(data)
        return {
          ...Utils.GetTableData(),
          title: "Vulnerability Open Ticket List",
          rows: data?.data?.map((item, index) => {
            const row = {
              Id: { key: "id", value: item.id, type: "hidden" },
              "S.No.": {
                key: "S.No.",
                value: index + 1,
                removeFromAutoSuggestion: true,
              },
              "Ticket id": {
                key: "ticket_id",
                value: item.ticket_id,
              },
              "Created On": {
                key: "created_on",
                value: item.created_on,
              },
              "Assigned To": {
                key: "cve",
                value: item.assigned_to,
              },
              "Priority": {
                key: "priority",
                value: item.priority,
              },
              "Status": {
                key: "status",
                value: item.status,
              }

            };
            return row;
          }),
           action: false,
           export:false,
           print:false,
          searchUrl: "/assetsTable.json",
          exportDataUrl: false,
          printUrl: false,
          paginationUrl: "http://192.168.40.52:5000/api/data/open?page=input&limit=count",
          totalPage: data?.total_pages,
          totalItemCount: data?.total,
          // autoSuggestionUrl: "/assetsTable.json",
          // initialSort: "Severity",
          getTableData: getTableData,
        };
      }

  

      const tableData = React.useMemo(() => getTableData(vulnerabilityOpenTicket), [vulnerabilityOpenTicket]);

  return ( <div className={styles.container}>
 <Table tableData={tableData} />
  </div>
  )
}

export default VulnerabilityOpenTicketTable